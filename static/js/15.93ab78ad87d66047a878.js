(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"/UYU":function(e,t,l){},I2b0:function(e,t,l){"use strict";l.r(t);var o=l("QbLZ"),s=l.n(o),a=l("L2JU"),i={computed:s()({},Object(a.mapGetters)({deployList:"deployModule/filterDeployList",pagination:"deployModule/pagination"})),methods:s()({},Object(a.mapActions)({updateJobStatusReq:"deployModule/updateJobStatus",getDeployListReq:"deployModule/getDeployList",getJiDetailReq:"deployModule/getJidDetail"}),{showJidDetail:function(e){this.getJiDetailReq(e),this.$showModal("jobIdDetail")},handleUpdate:function(e){var t={jobId:e.jobId};this.updateJobStatusReq(t)}})},r=l("KHd+"),n=Object(r.a)(i,function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{directives:[{name:"loading",rawName:"v-loading",value:e.$isShowLoading("deployList"),expression:"$isShowLoading('deployList')"}]},[l("el-table",{attrs:{data:e.deployList,border:""}},[l("el-table-column",{attrs:{label:"项目名称",prop:"project.name"}}),e._v(" "),l("el-table-column",{attrs:{label:"版本号",prop:"version.versionCode"}}),e._v(" "),l("el-table-column",{attrs:{label:"主机",prop:"minionId"}}),e._v(" "),l("el-table-column",{attrs:{label:"JID",prop:"jobId"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("a",{on:{click:function(l){e.showJidDetail(t.row)}}},[e._v(e._s(t.row.jobId))])]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return["RUNNING"===t.row.status?l("el-button",{attrs:{loading:!0,type:"text"}},[e._v("部署中\n                ")]):e._e(),e._v(" "),"FAILED"===t.row.status?l("el-tag",{attrs:{type:"danger"}},[e._v("部署失败\n                ")]):e._e(),e._v(" "),"SUCCESS"===t.row.status?l("el-tag",{attrs:{type:"success"}},[e._v("部署成功\n                ")]):e._e(),e._v(" "),"WAITING"===t.row.status?l("el-tag",{attrs:{type:"info"}},[e._v("等待部署\n                ")]):e._e()]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["SUCCESS"!==t.row.status&&"FAILED"!==t.row.status?l("el-button",{attrs:{type:"primary",size:"mini",plain:"",loading:e.$isShowLoading("deployList")},on:{click:function(l){e.handleUpdate(t.row)}}},[e._v("更新\n                ")]):e._e()]}}])})],1),e._v(" "),l("table-pagination",{attrs:{pagination:e.pagination}})],1)},[],!1,null,null,null).exports,d={data:function(){return{title:"",jobDetail:[],emptyText:""}},computed:s()({},Object(a.mapGetters)({data:"deployModule/filterJidDetail"})),methods:{handleOpenModal:function(){var e=this.data;this.title="["+e.minionId+"] "+e.project.name+" "+e.version.versionCode;try{var t=JSON.parse(e.result);this.praseResult(t[e.minionId])}catch(t){this.emptyText=e.result}},handleCloseModal:function(){this.$hideModal("jobIdDetail"),this.emptyText=""},praseResult:function(e){for(var t in this.jobDetail=[],e){var l=t.split("|"),o={key:l[0]+l[3],name:e[t].name,result:e[t].result,stderr:e[t].changes.stderr,duration:e[t].duration,start_time:e[t].start_time,run_num:e[t].__run_num__,id:e[t].__id__,comment:e[t].comment};this.jobDetail.push(o)}this.jobDetail.sort(function(e,t){return e.run_num-t.run_num})}}},u=(l("vQuU"),Object(r.a)(d,function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-dialog",{staticClass:"jobdetail-dialog",attrs:{title:e.title,visible:e.$isShowModal("jobIdDetail"),width:"90%"},on:{open:e.handleOpenModal,close:e.handleCloseModal}},[l("span",[""===e.emptyText?l("div",e._l(e.jobDetail,function(t){return l("div",{key:t.run_num},[l("p",[e._v("["+e._s(t.run_num)+"]  ["+e._s(t.start_time)+"]  "+e._s(t.key)+"  "+e._s(t.id)+"  "+e._s(t.comment)+"  "+e._s(t.stderr)+"  "+e._s(t.duration)+"  \n                     "),l("el-tag",{staticClass:"job-detail-tag",attrs:{type:t.result?"success":"danger"}},[e._v(e._s(t.result?"SUCCESS":"FAILED"))])],1)])})):l("div",[l("h3",{staticStyle:{"text-align":"center"}},[e._v("该数据无法解析，已为您显示原始数据！")]),e._v(" "),l("p",[e._v(e._s(e.emptyText))])])])])],1)},[],!1,null,null,null).exports),c={data:function(){return{form:{},deployOptions:[{status:"SUCCESS",label:"部署成功"},{status:"FAILED",label:"部署失败"},{status:"WAITING",label:"等待部署"},{status:"RUNNING",label:"部署中"}]}},created:function(){this.getProjectListReq({currentPage:1,pageSize:1e3}),this.getModListReq({currentPage:1,pageSize:1e3}),this.getSaltNodeListReq({currentPage:1,pageSize:1e3})},computed:s()({},Object(a.mapGetters)({deployTaskList:"deployModule/filterDeployList",projectList:"projectModule/filterProjectList",versionList:"versionModule/filterVersionList",saltNodeList:"saltNodeModule/filterSaltNodeList",modList:"modModule/filterModList"})),methods:s()({},Object(a.mapActions)({getProjectListReq:"projectModule/getProjectList",getVersionListReq:"versionModule/getVersionList",getDeployListReq:"deployModule/getDeployList",getSaltNodeListReq:"saltNodeModule/getSaltNodeList",getModListReq:"modModule/getModList"}),{getVersionList:function(){var e={projectId:this.form.projectId,currentPage:1,pageSize:1e3};this.getVersionListReq(e)},getDeployList:function(e){var t=this.$formatSearchData(this.form);this.getDeployListReq(t),this.$router.replace({query:t})}})},p={components:{List:n,Modal:u,Search:Object(r.a)(c,function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-card",{staticClass:"query-form",attrs:{shadow:"never"}},[l("el-form",{attrs:{inline:!0,model:e.form,"label-width":"54px",onsubmit:"return false"}},[l("el-form-item",{attrs:{label:"节点",prop:"saltNodeId"}},[l("el-select",{attrs:{placeholder:"请选择节点",filterable:"",clearable:""},model:{value:e.form.saltNodeId,callback:function(t){e.$set(e.form,"saltNodeId",t)},expression:"form.saltNodeId"}},e._l(e.saltNodeList,function(e){return l("el-option",{key:e.saltNodeId,attrs:{label:e.name,value:e.saltNodeId}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"模板",prop:"saltModId"}},[l("el-select",{attrs:{placeholder:"请选择脚本模板",filterable:"",clearable:""},model:{value:e.form.saltModId,callback:function(t){e.$set(e.form,"saltModId",t)},expression:"form.saltModId"}},e._l(e.modList,function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"项目名",prop:"projectId"}},[l("el-select",{attrs:{placeholder:"请选择项目",filterable:"",clearable:""},on:{change:function(t){e.getVersionList()}},model:{value:e.form.projectId,callback:function(t){e.$set(e.form,"projectId",t)},expression:"form.projectId"}},e._l(e.projectList,function(e){return l("el-option",{key:e.projectId,attrs:{label:e.name,value:e.projectId}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"版本号",prop:"versionId"}},[l("el-select",{attrs:{placeholder:"请选择一个版本",filterable:"",clearable:""},model:{value:e.form.versionId,callback:function(t){e.$set(e.form,"versionId",t)},expression:"form.versionId"}},e._l(e.versionList,function(e){return l("el-option",{key:e.versionId,attrs:{label:e.versionCode,value:e.versionId}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"状态",prop:"status"}},[l("el-select",{attrs:{placeholder:"请选择部署状态",clearable:"",filterable:""},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.deployOptions,function(e){return l("el-option",{key:e.status,attrs:{label:e.label,value:e.status}})}))],1),e._v(" "),l("el-form-item",[l("el-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:function(t){e.getDeployList(e.form)}}},[e._v("查询")])],1)],1)],1)},[],!1,null,null,null).exports},created:function(){this.getDeployList()},computed:{query:function(){return this.$route.query}},methods:s()({},Object(a.mapActions)({getDeployListReq:"deployModule/getDeployList"}),{getDeployList:function(){this.getDeployListReq(this.query)}}),watch:{query:function(){this.getDeployList()}}},m=Object(r.a)(p,function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("search"),this._v(" "),t("list"),this._v(" "),t("modal")],1)},[],!1,null,null,null);t.default=m.exports},vQuU:function(e,t,l){"use strict";var o=l("/UYU");l.n(o).a}}]);