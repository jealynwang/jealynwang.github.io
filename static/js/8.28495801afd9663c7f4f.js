(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{xghK:function(t,e,o){"use strict";o.r(e);var s=o("QbLZ"),l=o.n(s),r=o("L2JU"),i={data:function(){return{form:{}}},computed:l()({},Object(r.mapGetters)({filterClusterList:"clusterModule/filterClusterList",resouces:"projectModule/resouces"}),{query:function(){return this.$route.query}}),created:function(){this.getResoucesReq()},methods:l()({},Object(r.mapActions)({hostListReq:"hostModule/getHostList",getResoucesReq:"projectModule/getResouces"}),{getList:function(t){var e=this.$formatSearchData(this.form);this.hostListReq(e),this.$router.replace({query:e})}})},a=o("KHd+"),n=Object(a.a)(i,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-card",{staticClass:"query-form",attrs:{shadow:"never"}},[o("el-form",{attrs:{inline:!0,model:t.form,"label-width":"78px",onsubmit:"return false"}},[o("el-form-item",{attrs:{label:"minion ID"}},[o("el-input",{attrs:{placeholder:"请输入minionId",clearable:""},model:{value:t.form.minionId,callback:function(e){t.$set(t.form,"minionId","string"==typeof e?e.trim():e)},expression:"form.minionId"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"内网IP"}},[o("el-input",{attrs:{placeholder:"请输入内网IP地址",clearable:""},model:{value:t.form.privateIp,callback:function(e){t.$set(t.form,"privateIp","string"==typeof e?e.trim():e)},expression:"form.privateIp"}})],1),t._v(" "),o("el-form-item",{attrs:{prop:"platformId",label:"云平台",size:"small"}},[o("el-select",{attrs:{placeholder:"请选择云平台",filterable:"",clearable:""},model:{value:t.form.platformId,callback:function(e){t.$set(t.form,"platformId","string"==typeof e?e.trim():e)},expression:"form.platformId"}},t._l(t.resouces.platforms,function(t){return o("el-option",{key:t,attrs:{value:t,label:t}})}))],1),t._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:function(e){t.getList(t.form)}}},[t._v("查询")])],1),t._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"info",icon:"el-icon-circle-plus-outline",size:"small"},on:{click:function(e){t.$showModal("addHost")}}},[t._v("添加")])],1)],1)],1)},[],!1,null,null,null).exports,u={computed:l()({},Object(r.mapState)(["loading","btnLoading","hostModule"]),Object(r.mapGetters)({hostList:"hostModule/filterHostList",pagination:"hostModule/pagination"})),methods:l()({},Object(r.mapActions)({getDetail:"hostModule/getHostDetail",getCheckIn:"hostModule/getCheckIn"}),{handleEdit:function(t){this.getDetail(t),this.$showModal("updateHost")},getNodeList:function(){var t=l()({},this.$route.query);this.getNodeListReq(t)},getGroupList:function(){this.getGroupListReq(l()({},this.$route.query))},handleCheckIn:function(t){this.getCheckIn(t.hostId)},rowClassName:function(t){if(t.row.rid<=0)return"hidden"}})},p=Object(a.a)(u,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.$isShowLoading("hostList"),expression:"$isShowLoading('hostList')"}]},[o("el-table",{attrs:{data:t.hostList,border:"","row-class-name":t.rowClassName}},[o("el-table-column",{attrs:{label:"主机名",prop:"name"}}),t._v(" "),o("el-table-column",{attrs:{label:"host name",prop:"hostname","min-width":"100px"}}),t._v(" "),o("el-table-column",{attrs:{label:"minionId",prop:"minionId","min-width":"100px"}}),t._v(" "),o("el-table-column",{attrs:{label:"ip地址",prop:"privateIp"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("内网:\n                "),o("a",[t._v(t._s(e.row.privateIp))]),t._v(" "),o("br"),t._v("\n                公网："),o("a",[t._v(t._s(e.row.publicIp))])]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"是否在线",prop:"online"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.online?"是":"否")+"\n            ")]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"云平台",prop:"platformId"}}),t._v(" "),o("el-table-column",{attrs:{label:"说明",prop:"description"}}),t._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){t.handleCheckIn(e.row)}}},[t._v("在线检测")])]}}])})],1),t._v(" "),o("table-pagination",{attrs:{pagination:t.pagination}})],1)},[],!1,null,null,null).exports,d={data:function(){return{groups:[],ecsId:"",isAliyun:!1,hostForm:{id:"",hostId:"",name:"",privateIp:"",publicIp:"",platformId:"",saltNodeId:"",hostname:"",minionId:"",online:!1,runas:"",description:"",envId:"test"},groupForm:{name:"",description:"",groupId:""},rules:{saltNodeId:[{required:!0,message:"请选择所属节点",trigger:"blur"}],name:[{required:!0,message:"请输入服务器名称",trigger:"blur"}],platformId:[{required:!0,message:"请输入云平台",trigger:"blur"}],runas:[{required:!0,message:"请输入程序管理用户",trigger:"blur"}],privateIp:[{required:!0,message:"请输入内网IP地址",trigger:"blur"}],minionId:[{required:!0,message:"请输入节点标识",trigger:"blur"}]},rulesOfGroup:{name:[{required:!0,message:"请填写分组名称",trigger:"blur"}]}}},computed:l()({},Object(r.mapGetters)({hostDetail:"hostModule/filterHostDetail",saltNodeList:"saltNodeModule/filterSaltNodeList",ecsDetail:"hostModule/filterEcsDetail",groupList:"groupModule/filterGroupList",resouces:"projectModule/resouces"}),{title:function(){return this.$isShowModal("updateHost")?"更新服务器":"添加服务器"},modalIsShow:function(){return this.$isShowModal("addHost")||this.$isShowModal("updateHost")},isUpdate:function(){return this.$isShowModal("updateHost")},groupModalIsShow:function(){return this.$isShowModal("addGroupFromHost")}}),created:function(){this.getNodeListReq({currentPage:1,pageSize:1e3}),this.getGroupListReq({currentPage:1,pageSize:1e3})},methods:l()({},Object(r.mapActions)({addOrUpdateHost:"hostModule/addOrUpdateHost",getEcsInfoReq:"hostModule/getEcsInfo",getNodeListReq:"saltNodeModule/getSaltNodeList",getDetail:"hostModule/getHostDetail",getGroupListReq:"groupModule/getGroupList",addGroup:"groupModule/addGroup"}),{handleClose:function(){this.groups=[],this.$refs.hostForm.resetFields(),this.isUpdate?this.$hideModal("updateHost"):this.$hideModal("addHost")},setValue:function(){var t=this,e=this.hostDetail,o=e.id,s=e.hostId,l=e.name,r=e.privateIp,i=e.publicIp,a=e.platformId,n=e.saltNodeId,u=e.hostname,p=e.minionId,d=e.online,c=e.runas,m=e.description,h=e.envId;this.hostForm={id:o,hostId:s,name:l,privateIp:r,publicIp:i,platformId:a,saltNodeId:n,hostname:u,minionId:p,online:d,runas:c,description:m,envId:h},this.hostDetail.groups.map(function(e){t.groups.push(e.groupId)})},handleCloseGroup:function(){this.$refs.groupForm.resetFields(),this.$hideModal("addGroupFromHost")},getNodeList:function(){var t=l()({},this.$route.query);this.getNodeListReq(t)},handleCreateGroup:function(){this.$showModal("addGroupFromHost")},getEcsInfo:function(){this.getEcsInfoReq({ecsId:this.ecsId})},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(t){var o=e.$trim(l()({},e.hostForm,{groups:e.groups}));e.isUpdate||delete o.id,e.addOrUpdateHost(o)}})},submitGroupForm:function(t){var e=this;this.$refs[t].validate(function(t){if(t){var o=e.$trim(l()({},e.groupForm,{origin:"host",envId:"test"}));e.addGroup(o)}})}}),watch:{hostDetail:{handler:function(){this.setValue()},immediate:!1},ecsDetail:function(){this.hostForm.privateIp=this.ecsDetail.privateIp,this.hostForm.publicIp=this.ecsDetail.publicIp,this.hostForm.name=this.ecsDetail.name,this.hostForm.hostname=this.ecsDetail.hostname}}},c={computed:{modalIsShow:function(){return this.$isShowModal("addEcsBatch")}},methods:{handleClose:function(){return this.$hideModal("addEcsBatch")}}},m={components:{Search:n,List:p,Modal:Object(a.a)(d,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-dialog",{attrs:{visible:t.modalIsShow,"before-close":t.handleClose,center:"",title:t.title,width:"35%"},on:{close:t.handleClose}},[o("el-form",{ref:"hostForm",attrs:{model:t.hostForm,rules:t.rules,"label-width":"80px","status-icon":!0}},[o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{prop:"name",label:"名称",size:"small"}},[o("el-input",{attrs:{placeholder:"请输入服务器名称",maxlength:50},model:{value:t.hostForm.name,callback:function(e){t.$set(t.hostForm,"name","string"==typeof e?e.trim():e)},expression:"hostForm.name"}})],1)],1)],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{prop:"isAliyun",label:"ali ECS",size:"small"}},[o("el-switch",{attrs:{disabled:t.isUpdate},model:{value:t.isAliyun,callback:function(e){t.isAliyun="string"==typeof e?e.trim():e},expression:"isAliyun"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:11,offset:1}},[t.isAliyun?o("el-form-item",{attrs:{prop:"ecsId",label:"ecsId",size:"small"}},[o("el-input",{attrs:{placeholder:"请输入实例ID",maxlength:50},on:{blur:t.getEcsInfo},model:{value:t.ecsId,callback:function(e){t.ecsId="string"==typeof e?e.trim():e},expression:"ecsId"}})],1):t._e()],1)],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{prop:"privateIp",label:"内网ip",size:"small"}},[o("el-input",{attrs:{placeholder:"请输入内网ip地址",maxlength:50},model:{value:t.hostForm.privateIp,callback:function(e){t.$set(t.hostForm,"privateIp","string"==typeof e?e.trim():e)},expression:"hostForm.privateIp"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:11,offset:1}},[o("el-form-item",{attrs:{prop:"publicIp",label:"公网ip",size:"small"}},[o("el-input",{attrs:{placeholder:"请输入公网ip地址",maxlength:50},model:{value:t.hostForm.publicIp,callback:function(e){t.$set(t.hostForm,"publicIp","string"==typeof e?e.trim():e)},expression:"hostForm.publicIp"}})],1)],1)],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{prop:"platformId",label:"云平台",size:"small"}},[o("el-select",{attrs:{placeholder:"请选择云平台",filterable:""},model:{value:t.hostForm.platformId,callback:function(e){t.$set(t.hostForm,"platformId","string"==typeof e?e.trim():e)},expression:"hostForm.platformId"}},t._l(t.resouces.platforms,function(t){return o("el-option",{key:t,attrs:{value:t,label:t}})}))],1)],1)],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{prop:"saltNodeId",label:"所属节点",size:"small"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-select",{attrs:{placeholder:"请选择管理节点",filterable:""},model:{value:t.hostForm.saltNodeId,callback:function(e){t.$set(t.hostForm,"saltNodeId","string"==typeof e?e.trim():e)},expression:"hostForm.saltNodeId"}},t._l(t.saltNodeList,function(t){return o("el-option",{key:t.saltNodeId,attrs:{value:t.saltNodeId,label:t.name}})}))]}}])})],1),t._v(" "),o("el-col",{attrs:{span:11,offset:1}},[o("el-form-item",{attrs:{prop:"runas",label:"执行用户",size:"small"}},[o("el-input",{attrs:{placeholder:"请输入程序管理用户",maxlength:50},model:{value:t.hostForm.runas,callback:function(e){t.$set(t.hostForm,"runas","string"==typeof e?e.trim():e)},expression:"hostForm.runas"}})],1)],1)],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{prop:"hostname",label:"HostName",size:"small"}},[o("el-input",{attrs:{placeholder:"请输入Host Name",maxlength:50},model:{value:t.hostForm.hostname,callback:function(e){t.$set(t.hostForm,"hostname","string"==typeof e?e.trim():e)},expression:"hostForm.hostname"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:11,offset:1}},[o("el-form-item",{attrs:{prop:"minionId",label:"minionId",size:"small"}},[o("el-input",{attrs:{placeholder:"请输入节点标识",maxlength:50},model:{value:t.hostForm.minionId,callback:function(e){t.$set(t.hostForm,"minionId","string"==typeof e?e.trim():e)},expression:"hostForm.minionId"}})],1)],1)],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:23}},[o("el-form-item",{attrs:{prop:"description",label:"说明",size:"small"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请填写一些备注信息",maxlength:50},model:{value:t.hostForm.description,callback:function(e){t.$set(t.hostForm,"description","string"==typeof e?e.trim():e)},expression:"hostForm.description"}})],1)],1)],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:17}},[o("el-form-item",{attrs:{label:"分组"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分组",filterable:"",multiple:""},model:{value:t.groups,callback:function(e){t.groups=e},expression:"groups"}},t._l(t.groupList,function(t){return o("el-option",{key:t.groupId,staticStyle:{"max-width":"100%"},attrs:{label:t.name,value:t.groupId}})}))]}}])})],1),t._v(" "),o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{size:"small"}},[o("el-button",{attrs:{type:"text"},on:{click:t.handleCreateGroup}},[t._v("创建服务器组")])],1)],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:t.handleClose}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary",size:"small",loading:t.$isShowLoading("hostAddOrUpdate")},on:{click:function(e){t.submitForm("hostForm")}}},[t._v("确 定")])],1)],1),t._v(" "),o("el-dialog",{attrs:{visible:t.groupModalIsShow,"before-close":t.handleCloseGroup,center:"",title:"新增服务器分组",width:"30%",top:"25vh","close-on-click-modal":!1},on:{close:t.handleCloseGroup}},[o("el-form",{ref:"groupForm",attrs:{model:t.groupForm,rules:t.rulesOfGroup,"label-width":"100px","status-icon":!0}},[o("el-row",[o("el-col",{attrs:{span:22}},[o("el-form-item",{attrs:{prop:"name",label:"名称"}},[o("el-input",{attrs:{placeholder:"请输入分组名称",maxlength:50},model:{value:t.groupForm.name,callback:function(e){t.$set(t.groupForm,"name","string"==typeof e?e.trim():e)},expression:"groupForm.name"}})],1)],1)],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:22}},[o("el-form-item",{attrs:{prop:"description",label:"说明"}},[o("el-input",{attrs:{type:"textarea",rows:"2",placeholder:"请填写关于该分组的描述信息",maxlength:50},model:{value:t.groupForm.description,callback:function(e){t.$set(t.groupForm,"description","string"==typeof e?e.trim():e)},expression:"groupForm.description"}})],1)],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.handleCloseGroup}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitGroupForm("groupForm")}}},[t._v("确 定")])],1)],1)],1)},[],!1,null,null,null).exports,EcsModal:Object(a.a)(c,function(){var t=this.$createElement;return(this._self._c||t)("el-dialog",{attrs:{visible:this.modalIsShow,"before-close":this.handleClose,center:"",title:"批量添加",width:"35%"}})},[],!1,null,null,null).exports},created:function(){this.getHostList()},computed:{query:function(){return this.$route.query}},methods:l()({},Object(r.mapActions)({getListReq:"hostModule/getHostList"}),{getHostList:function(){this.getListReq(this.query)}}),watch:{query:function(){this.getHostList()}}},h=Object(a.a)(m,function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("Search"),this._v(" "),e("List"),this._v(" "),e("Modal"),this._v(" "),e("ecs-modal")],1)},[],!1,null,null,null);e.default=h.exports}}]);