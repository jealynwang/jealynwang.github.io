(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"1hdG":function(e,t,o){"use strict";o.r(t);var i=o("QbLZ"),r=o.n(i),s=o("L2JU"),l={data:function(){return{form:{},deployOptions:[{status:"SUCCESS",label:"部署成功"},{status:"FAILED",label:"部署失败"},{status:"WAITING",label:"等待部署"},{status:"RUNNING",label:"部署中"}],buildOptions:[{status:"SUCCESS",label:"编译成功"},{status:"FAILED",label:"编译失败"},{status:"RUNNING",label:"编译中"}],approveOptions:[{status:"ALLOW",label:"审核通过"},{status:"DENY",label:"审核未过"},{status:"UNDER_REVIEW",label:"审核中"},{status:"IGNORE",label:"无需审核"}]}},computed:r()({},Object(s.mapGetters)({projectList:"projectModule/filterProjectList",projectDetail:"projectModule/filterProjectDetail"})),created:function(){this.getProjectList()},methods:r()({},Object(s.mapActions)({getProjectListReq:"projectModule/getProjectList",getProjectDetailReq:"projectModule/getProjectDetail",getVersionDetailReq:"versionModule/getVersionList"}),{getProjectList:function(){this.getProjectListReq({pageSize:1e3})},getProjectDetail:function(e){if(""!==e){var t={projectId:e};this.getProjectDetailReq(t)}},getVersionList:function(e){var t=this.$formatSearchData(this.form);this.getVersionDetailReq(t),this.$router.replace({query:t})}}),watch:{}},a=o("KHd+"),n=Object(a.a)(l,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-card",{staticClass:"query-form",attrs:{shadow:"never"}},[o("el-form",{attrs:{inline:!0,model:e.form,"label-width":"68px",onsubmit:"return false"}},[o("el-form-item",{attrs:{label:"版本号",prop:"versionCode"}},[o("el-input",{attrs:{placeholder:"请输入版本号",clearable:""},model:{value:e.form.versionCode,callback:function(t){e.$set(e.form,"versionCode","string"==typeof t?t.trim():t)},expression:"form.versionCode"}})],1),e._v(" "),o("el-form-item",{attrs:{prop:"projectId",label:"项目名称"}},[o("el-select",{attrs:{placeholder:"请选择项目名称",filterable:"",clearable:""},on:{change:function(t){e.getProjectDetail(e.form.projectId)}},model:{value:e.form.projectId,callback:function(t){e.$set(e.form,"projectId",t)},expression:"form.projectId"}},e._l(e.projectList,function(e){return o("el-option",{key:e.projectId,attrs:{label:e.name,value:e.projectId}})}))],1),e._v(" "),o("el-form-item",{attrs:{prop:"buildStatus",label:"编译状态"}},[o("el-select",{attrs:{placeholder:"请选择编译状态",clearable:"",filterable:""},model:{value:e.form.buildStatus,callback:function(t){e.$set(e.form,"buildStatus",t)},expression:"form.buildStatus"}},e._l(e.buildOptions,function(e){return o("el-option",{key:e.status,attrs:{label:e.label,value:e.status}})}))],1),e._v(" "),o("el-form-item",{attrs:{prop:"deployStatus",label:"部署状态"}},[o("el-select",{attrs:{placeholder:"请选择部署状态",clearable:"",filterable:""},model:{value:e.form.deployStatus,callback:function(t){e.$set(e.form,"deployStatus",t)},expression:"form.deployStatus"}},e._l(e.deployOptions,function(e){return o("el-option",{key:e.status,attrs:{label:e.label,value:e.status}})}))],1),e._v(" "),o("el-form-item",{attrs:{prop:"approveStatus",label:"审核状态"}},[o("el-select",{attrs:{placeholder:"请选择审核状态",clearable:"",filterable:""},model:{value:e.form.approveStatus,callback:function(t){e.$set(e.form,"approveStatus",t)},expression:"form.approveStatus"}},e._l(e.approveOptions,function(e){return o("el-option",{key:e.status,attrs:{label:e.label,value:e.status}})}))],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:function(t){e.getVersionList(e.form)}}},[e._v("\n              查询\n            ")])],1)],1)],1)},[],!1,null,null,null).exports,u={data:function(){return{}},computed:r()({},Object(s.mapGetters)({versionList:"versionModule/filterVersionList",versionDetail:"versionModule/filterVersionDetail",pagination:"versionModule/pagination"})),methods:r()({},Object(s.mapActions)({buildVersionReq:"operationModule/addbuildVersion",reBuildVersionReq:"operationModule/reBuildVersion",getVersionDetailReq:"versionModule/getVersionDetail",getVersionListReq:"versionModule/getVersionList",getBuildListReq:"buildModule/getBuildList",getDeployListReq:"deployModule/getDeployList",getDownSqlReq:"operationModule/getDownSql"}),{rowClassName:function(e){if(e.row.rid<=0)return"hidden"},handleRebuild:function(e){var t=this;e.visible=!1;var o=e.versionId;this.reBuildVersionReq({versionId:o}).then(function(){var e=r()({},t.pagination);t.getVersionListReq(e)})},handleDeploy:function(e){this.$showModal("deployVersion"),this.getVersionDetailReq(e)},handleGoConfig:function(e){""!==e&&this.$router.push({path:"/configCenter/project/Apollo/Detail",query:{configId:e,idc:"aliyun"}})},handleDownSql:function(e){var t={ossKey:e};this.getDownSqlReq(t)},handleEdit:function(e){this.getVersionDetailReq(e),this.$showModal("updateVersion")},handleBuildStatus:function(e,t,o,i){if("buildStatus"===t.property){this.$showModal("buildDetail");var s=r()({},this.$route.query,{versionId:e.versionId});this.getBuildListReq(s)}if("deployStatus"===t.property){this.$showModal("deployDetail");var l=r()({},this.$route.query,{versionId:e.versionId});this.getDeployListReq(l)}}})},c=(o("HDVv"),Object(a.a)(u,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.$isShowLoading("versionList"),expression:"$isShowLoading('versionList')"}],attrs:{"element-loading-text":"正在加载中..."}},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.versionList,border:"","row-class-name":e.rowClassName},on:{"cell-click":e.handleBuildStatus}},[o("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[o("el-form-item",{attrs:{label:"创建者"}},[o("span",[e._v(e._s(t.row.createdBy))])]),e._v(" "),o("el-form-item",{attrs:{label:"更新者"}},[o("span",[e._v(e._s(t.row.updatedBy))])]),e._v(" "),o("el-form-item",{attrs:{label:"审核人"}},[o("span",[e._v(e._s(t.row.approveBy||"-"))])]),e._v(" "),o("el-form-item",{attrs:{label:"sql地址"}},[t.row.sqlUrl?o("span",[o("el-button",{attrs:{type:"text"},on:{click:function(o){e.handleDownSql(t.row.sqlUrl)}}},[e._v("下载")])],1):o("span",[e._v("-")])]),e._v(" "),o("el-form-item",{attrs:{label:"sql更新说明"}},[o("span",[e._v(e._s(t.row.sqlInfo||"-"))])])],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"项目名称",prop:"project.name"}}),e._v(" "),o("el-table-column",{attrs:{label:"版本号",prop:"versionCode",width:"120px"}}),e._v(" "),o("el-table-column",{attrs:{label:"分支/Tag"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-popover",{attrs:{placement:"top",trigger:"hover",content:t.row.commit||"未更新"}},[o("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[t.row.gitTag?o("div",[e._v("Tag: "+e._s(t.row.gitTag))]):e._e(),e._v(" "),t.row.gitBranch?o("div",[e._v("分支："+e._s(t.row.gitBranch))]):e._e()])],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"配置文件",prop:"configId"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-popover",{attrs:{placement:"top",trigger:"hover",content:t.row.configInfo||"配置文件未更新"}},[o("el-button",{attrs:{slot:"reference",type:"text"},on:{click:function(o){e.handleGoConfig(t.row.project.configId)}},slot:"reference"},[e._v(e._s(t.row.project.configId?t.row.project.configId:""))])],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"编译状态",prop:"buildStatus",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return["SUCCESS"===t.row.buildStatus?o("el-tag",{attrs:{type:"success"}},[e._v("编译成功\n                ")]):"FAILED"===t.row.buildStatus?o("el-tag",{attrs:{type:"danger"}},[e._v("编译失败\n                ")]):"RUNNING"===t.row.buildStatus?o("el-button",{attrs:{loading:!0,size:"small",type:"text"}},[e._v("编译中\n                ")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"部署状态",prop:"deployStatus",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return["SUCCESS"===t.row.deployStatus?o("el-tag",{attrs:{type:"success"}},[e._v("部署成功\n                ")]):"FAILED"===t.row.deployStatus?o("el-tag",{attrs:{type:"danger"}},[e._v("部署失败\n                ")]):"RUNNING"===t.row.deployStatus?o("el-button",{attrs:{size:"small",loading:!0,type:"text"}},[e._v("部署中\n                ")]):"WAITING"===t.row.deployStatus?o("el-tag",{attrs:{type:"warning"}},[e._v("等待部署\n                ")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"立即部署",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.deployImmediately?"是":"否")+"\n            ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"审核状态",prop:"approveStatus",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return["ALLOW"===t.row.approveStatus?o("el-tag",{attrs:{type:"success"}},[e._v("审核通过\n                ")]):"DENY"===t.row.approveStatus?o("el-tag",{attrs:{type:"danger"}},[e._v("审核未过\n                ")]):"UNDER_REVIEW"===t.row.approveStatus?o("el-tag",[e._v("审核中\n                ")]):"IGNORE"===t.row.approveStatus?o("el-tag",{attrs:{type:"warning"}},[e._v("无需审核 \n                ")]):o("span",[e._v("-")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"创建时间",prop:"createdTime"}}),e._v(" "),o("el-table-column",{attrs:{label:"更新时间",prop:"updatedTime"}}),e._v(" "),o("el-table-column",{attrs:{label:"操作",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){e.handleEdit(t.row)}}},[e._v("编辑")])],1),e._v(" "),o("div",[o("el-popover",{attrs:{placement:"top",width:"160",trigger:"click"},model:{value:t.row.visible,callback:function(o){e.$set(t.row,"visible",o)},expression:"scope.row.visible"}},[o("p",[e._v("确定重新编译该项目？")]),e._v(" "),o("div",{staticStyle:{"text-align":"right",margin:"0"}},[o("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.row.visible=!1}}},[e._v("\n                                取消\n                            ")]),e._v(" "),o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){e.handleRebuild(t.row)}}},[e._v("\n                                确定\n                            ")])],1),e._v(" "),o("el-button",{staticStyle:{"margin-top":"6px"},attrs:{slot:"reference",plain:"",size:"small",loading:e.$isShowLoading("rebuildVersionList")},slot:"reference"},[e._v("\n                            编译\n                        ")])],1)],1),e._v(" "),o("div",["SUCCESS"!==t.row.buildStatus||"ALLOW"!==t.row.approveStatus&&"IGNORE"!==t.row.approveStatus?e._e():o("el-button",{staticStyle:{"margin-top":"6px"},attrs:{type:"primary",plain:"",size:"small"},on:{click:function(o){e.handleDeploy(t.row)}}},[e._v("部署\n                    ")])],1)]}}])})],1),e._v(" "),o("table-pagination",{attrs:{pagination:e.pagination}})],1)},[],!1,null,null,null).exports),d={data:function(){return{title:"",jobDetail:[],emptyText:""}},computed:r()({},Object(s.mapGetters)({buildTaskList:"buildModule/filterBuildList",deployTaskList:"deployModule/filterDeployList"}),{buildModalIsShow:function(){return this.$isShowModal("buildDetail")},deployModalIsShow:function(){return this.$isShowModal("deployDetail")}}),methods:r()({},Object(s.mapActions)({freshBuildStatusReq:"buildModule/freshBuildStatus",updateJobStatusReq:"deployModule/updateJobStatus"}),{showJidDetail:function(e){this.title="["+e.minionId+"] "+e.project.name+" "+e.version.versionCode;try{var t=JSON.parse(e.result);this.praseResult(t[e.minionId]),this.$showModal("jobIdDetail")}catch(t){this.emptyText=e.result,this.$showModal("jobIdDetail")}},praseResult:function(e){for(var t in this.jobDetail=[],e){var o=t.split("|"),i={key:o[0]+o[3],name:e[t].name,result:e[t].result,stderr:e[t].changes.stderr,duration:e[t].duration,start_time:e[t].start_time,run_num:e[t].__run_num__,id:e[t].__id__,comment:e[t].comment};this.jobDetail.push(i)}this.jobDetail.sort(function(e,t){return e.run_num-t.run_num})},handleCloseModal:function(){this.$hideModal("jobIdDetail"),this.emptyText=""},handleFresh:function(e){var t=r()({},e,{origin:"version"});this.freshBuildStatusReq(t)},handleUpdate:function(e){var t={jobId:e.jobId,origin:"version"};this.updateJobStatusReq(t)},closeModal:function(){this.$hideModal("buildDetail"),this.$hideModal("deployDetail")}})},p=(o("XXEi"),Object(a.a)(d,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-dialog",{attrs:{title:"编译任务",visible:e.buildModalIsShow,width:"38%","before-close":e.closeModal,"close-on-click-modal":!1,center:""}},[o("el-table",{ref:"",attrs:{data:e.buildTaskList,size:"mini",border:""}},[o("el-table-column",{attrs:{property:"buildId",label:"jenkins任务"}}),e._v(" "),o("el-table-column",{attrs:{property:"",label:"任务链接",width:"380"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("a",{attrs:{href:t.row.project.jenkinsUrl+t.row.buildId+"/console",target:"blank"}},[e._v(e._s(t.row.project.jenkinsUrl+t.row.buildId+"/console"))])]}}])}),e._v(" "),o("el-table-column",{attrs:{property:"buildStatus",label:"编译状态"},scopedSlots:e._u([{key:"default",fn:function(t){return["SUCCESS"===t.row.buildStatus?o("el-tag",{attrs:{type:"success"}},[e._v("完成")]):"FAILED"===t.row.buildStatus?o("el-tag",{attrs:{type:"warning"}},[e._v("失败")]):"RUNNING"===t.row.buildStatus?o("el-button",{attrs:{loading:!0,type:"text"}},[e._v("编译中")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["RUNNING"===t.row.buildStatus?o("el-button",{attrs:{type:"primary",plain:"",size:"mini",loading:e.$isShowLoading("freshBuildStatus")},on:{click:function(o){e.handleFresh(t.row)}}},[e._v("\n                        更新\n                    ")]):e._e()]}}])})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"部署任务",visible:e.deployModalIsShow,width:"980px","before-close":e.closeModal,"close-on-click-modal":!1,center:""}},[o("el-table",{ref:"",attrs:{data:e.deployTaskList,size:"mini",border:""}},[o("el-table-column",{attrs:{property:"version.versionCode",label:"版本号"}}),e._v(" "),o("el-table-column",{attrs:{property:"saltNode.name",label:"管理节点","min-width":"100px"}}),e._v(" "),o("el-table-column",{attrs:{property:"host.name",label:"目标服务器"}}),e._v(" "),o("el-table-column",{attrs:{property:"host.privateIp",label:"内网地址"}}),e._v(" "),o("el-table-column",{attrs:{property:"host.runas",label:"runas"}}),e._v(" "),o("el-table-column",{attrs:{property:"jobId",label:"任务ID",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("a",{on:{click:function(o){e.showJidDetail(t.row)}}},[e._v(e._s(t.row.jobId))])]}}])}),e._v(" "),o("el-table-column",{attrs:{property:"status",label:"部署状态"},scopedSlots:e._u([{key:"default",fn:function(t){return["SUCCESS"===t.row.status?o("el-tag",{attrs:{type:"success"}},[e._v("完成")]):"FAILED"===t.row.status?o("el-tag",{attrs:{type:"warning"}},[e._v("失败")]):"RUNNING"===t.row.status?o("el-button",{attrs:{loading:!0,type:"text"}},[e._v("部署中")]):"WAITING"===t.row.status?o("el-tag",{attrs:{type:"info"}},[e._v("等待部署")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["SUCCESS"!==t.row.status&&"FAILED"!==t.row.status?o("el-button",{attrs:{type:"primary",size:"mini",plain:"",loading:e.$isShowLoading("getJobStatus")},on:{click:function(o){e.handleUpdate(t.row)}}},[e._v("更新\n                ")]):e._e()]}}])})],1)],1),e._v(" "),o("el-dialog",{staticClass:"jobdetail-dialog",attrs:{title:e.title,visible:e.$isShowModal("jobIdDetail"),width:"90%"},on:{close:e.handleCloseModal}},[o("span",[""===e.emptyText?o("div",e._l(e.jobDetail,function(t){return o("div",{key:t.run_num},[o("p",[e._v("["+e._s(t.run_num)+"]  ["+e._s(t.start_time)+"]  "+e._s(t.key)+"  "+e._s(t.id)+"  "+e._s(t.comment)+"  "+e._s(t.stderr)+"  "+e._s(t.duration)+"  \n                    "),o("el-tag",{staticClass:"job-detail-tag",attrs:{type:t.result?"success":"danger"}},[e._v(e._s(t.result?"SUCCESS":"FAILED"))])],1)])})):o("div",[o("h3",{staticStyle:{"text-align":"center"}},[e._v("该数据无法解析，已为您显示原始数据！")]),e._v(" "),o("p",[e._v(e._s(e.emptyText))])])])])],1)},[],!1,null,null,null).exports),_=(o("srmC"),o("qNmG"),{data:function(){var e=this;return{deployForm:{versionId:"",groupId:"",hostList:[],modId:""},updateForm:{},cmOption:{tabSize:4,styleActiveLine:!0,lineNumbers:!0,line:!1,mode:"text/x-nginx-conf",theme:"cobalt",readOnly:!0},cmOption2:{tabSize:4,styleActiveLine:!0,lineNumbers:!0,line:!1,mode:"text/x-nginx-conf",theme:"cobalt",readOnly:!0},rules:{modId:[{required:!0,message:"请选择部署模块",trigger:"blur"}],hostList:[{validator:function(t,o,i){e.deployForm.groupId||o?i():i(new Error("服务器和服务器组至少选择一项"))},trigger:"blur"}],groupId:[{validator:function(t,o,i){0!==e.deployForm.hostList.length||o?i():i(new Error("服务器和服务器组至少选择一项"))},trigger:"blur"}]}}},computed:r()({},Object(s.mapGetters)({versionDetail:"versionModule/filterVersionDetail",filterHostList:"hostModule/filterHostList",groupList:"groupModule/filterGroupList",modList:"modModule/filterModList"}),{modalIsShow:function(){return this.$isShowModal("deployVersion")},updateModalIsShow:function(){return this.$isShowModal("updateVersion")}}),methods:r()({},Object(s.mapActions)({getHostListReq:"hostModule/getHostList",getGroupListReq:"groupModule/getGroupList",getVersionListReq:"versionModule/getVersionList",getModListReq:"modModule/getModList",deployVersionReq:"operationModule/deployVersion",updateVersionReq:"operationModule/updateVersion"}),{closeModal:function(){this.$hideModal("deployVersion"),this.$hideModal("updateVersion")},handleCloseModal:function(){this.deployForm={versionId:"",groupId:"",hostList:[],modId:""},this.updateForm={}},handleSelect:function(){var e=this;this.getHostListReq({currentPage:1,pageSize:1e3}).then(function(){e.deployForm.hostList=e.versionDetail.hosts||[]}),this.getModListReq({currentPage:1,pageSize:1e3}).then(function(){e.deployForm.modId=e.versionDetail.project.modId||""}),this.getGroupListReq({currentPage:1,pageSize:1e3}).then(function(){e.deployForm.groupId=e.versionDetail.project.defaultGroupId})},handleSelectMod:function(){this.getModListReq(this.$route.query)},handleNginxChange:function(e){this.cmOption2.readOnly=!e},handleSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(e){t.deployForm.commit=t.versionDetail.commit,t.deployForm.configInfo=t.versionDetail.configInfo,t.deployForm.configUpdate=t.versionDetail.configUpdate,t.deployForm.sqlInfo=t.versionDetail.sqlInfo,t.deployForm.sqlUrl=t.versionDetail.sqlUrl,t.deployForm.versionId=t.versionDetail.versionId,t.deployForm.nginxContent=t.versionDetail.nginxContent,t.deployForm.nginxUpdate=t.versionDetail.nginxUpdate;var o=t.$trim(r()({},t.deployForm));t.isUpdate||delete o.id,t.deployVersionReq(o).then(function(){var e=r()({},t.pagination);t.getVersionListReq(e)})}})},handleUpdate:function(e){var t=this;this.$refs[e].validate(function(e){if(e){t.updateForm.versionId=t.versionDetail.versionId,t.updateForm.configInfo=t.versionDetail.configInfo,t.updateForm.configUpdate=t.versionDetail.configUpdate,t.updateForm.nginxContent=t.versionDetail.nginxContent,t.updateForm.nginxUpdate=t.versionDetail.nginxUpdate;var o=t.$trim(r()({},t.updateForm));t.updateVersionReq(o).then(function(){var e=r()({},t.pagination);t.getVersionListReq(e),t.updateForm={}})}})}})}),m={data:function(){return{}},components:{List:c,Search:n,StatusModal:p,deploymodal:Object(a.a)(_,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-dialog",{attrs:{title:"[版本部署] "+e.versionDetail.versionCode,visible:e.modalIsShow,width:"45%","before-close":e.closeModal,"close-on-click-modal":!1,center:""},on:{open:e.handleSelect,close:e.handleCloseModal}},[o("el-form",{ref:"deployForm",attrs:{model:e.deployForm,"label-width":"130px",rules:e.rules}},[o("el-form-item",{attrs:{label:"部署模板",prop:"modId"}},[o("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",clearable:"",placeholder:"请选择部署模板"},model:{value:e.deployForm.modId,callback:function(t){e.$set(e.deployForm,"modId",t)},expression:"deployForm.modId"}},e._l(e.modList,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"部署服务器组",prop:"groupId"}},[o("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",clearable:"",placeholder:"请选择目标服务器组"},model:{value:e.deployForm.groupId,callback:function(t){e.$set(e.deployForm,"groupId",t)},expression:"deployForm.groupId"}},e._l(e.groupList,function(e){return o("el-option",{key:e.groupId,attrs:{label:e.name,value:e.groupId}})}))],1),e._v(" "),o("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"部署服务器",prop:"hostList"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:"请选择部署服务器"},model:{value:e.deployForm.hostList,callback:function(t){e.$set(e.deployForm,"hostList",t)},expression:"deployForm.hostList"}},e._l(e.filterHostList,function(e){return o("el-option",{key:e.hostId,staticStyle:{"max-width":"100%"},attrs:{label:e.name+" "+e.privateIp,value:e.hostId}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"更新内容"}},[o("el-input",{attrs:{type:"textarea",autosize:"",disabled:""},model:{value:e.versionDetail.commit,callback:function(t){e.$set(e.versionDetail,"commit",t)},expression:"versionDetail.commit"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"是否更新配置文件"}},[o("el-switch",{attrs:{disabled:""},model:{value:e.versionDetail.configUpdate,callback:function(t){e.$set(e.versionDetail,"configUpdate",t)},expression:"versionDetail.configUpdate"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"配置文件内容"}},[o("el-input",{attrs:{disabled:"",type:"textarea"},model:{value:e.versionDetail.configInfo,callback:function(t){e.$set(e.versionDetail,"configInfo","string"==typeof t?t.trim():t)},expression:"versionDetail.configInfo"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"是否更新Nginx"}},[o("el-switch",{attrs:{disabled:""},model:{value:e.versionDetail.nginxUpdate,callback:function(t){e.$set(e.versionDetail,"nginxUpdate","string"==typeof t?t.trim():t)},expression:"versionDetail.nginxUpdate"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"nginx内容"}},[o("div",{staticClass:"codemirror"},[o("codemirror",{attrs:{options:e.cmOption},model:{value:e.versionDetail.nginxContent,callback:function(t){e.$set(e.versionDetail,"nginxContent",t)},expression:"versionDetail.nginxContent"}})],1)]),e._v(" "),""!==e.versionDetail.sqlUrl?o("el-form-item",{attrs:{label:"sql更新说明"}},[o("el-input",{attrs:{type:"textarea",disabled:""},model:{value:e.versionDetail.sqlInfo,callback:function(t){e.$set(e.versionDetail,"sqlInfo","string"==typeof t?t.trim():t)},expression:"versionDetail.sqlInfo"}})],1):e._e()],1),e._v(" "),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleSubmit("deployForm")}}},[e._v("提 交")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"更新版本",visible:e.updateModalIsShow,width:"45%","before-close":e.closeModal,"close-on-click-modal":!1,center:""},on:{close:e.handleCloseModal}},[o("el-form",{ref:"updateForm",attrs:{model:e.updateForm,"label-width":"130px",rules:e.rules}},[o("el-form-item",{attrs:{label:"是否更新配置文件"}},[o("el-switch",{model:{value:e.versionDetail.configUpdate,callback:function(t){e.$set(e.versionDetail,"configUpdate",t)},expression:"versionDetail.configUpdate"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"配置文件内容"}},[o("el-input",{attrs:{disabled:!e.versionDetail.configUpdate,type:"textarea",autosize:""},model:{value:e.versionDetail.configInfo,callback:function(t){e.$set(e.versionDetail,"configInfo","string"==typeof t?t.trim():t)},expression:"versionDetail.configInfo"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"是否更新Nginx"}},[o("el-switch",{on:{change:function(t){e.handleNginxChange(e.versionDetail.nginxUpdate)}},model:{value:e.versionDetail.nginxUpdate,callback:function(t){e.$set(e.versionDetail,"nginxUpdate","string"==typeof t?t.trim():t)},expression:"versionDetail.nginxUpdate"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"nginx内容"}},[o("div",{staticClass:"codemirror"},[o("codemirror",{attrs:{options:e.cmOption2},model:{value:e.versionDetail.nginxContent,callback:function(t){e.$set(e.versionDetail,"nginxContent",t)},expression:"versionDetail.nginxContent"}})],1)])],1),e._v(" "),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleUpdate("updateForm")}}},[e._v("提 交")])],1)],1)],1)},[],!1,null,null,null).exports},computed:r()({},Object(s.mapGetters)({versionList:"versionModule/filterVersionList"}),{query:function(){return this.$route.query}}),created:function(){this.getVersionList()},methods:r()({},Object(s.mapActions)({getListReq:"versionModule/getVersionList"}),{getVersionList:function(){this.getListReq(this.query)}})},f=Object(a.a)(m,function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("search"),this._v(" "),t("list"),this._v(" "),t("deploymodal"),this._v(" "),t("status-modal")],1)},[],!1,null,null,null);t.default=f.exports},HDVv:function(e,t,o){"use strict";var i=o("JKIM");o.n(i).a},JKIM:function(e,t,o){},XXEi:function(e,t,o){"use strict";var i=o("Z/ns");o.n(i).a},"Z/ns":function(e,t,o){},qNmG:function(e,t,o){},srmC:function(e,t,o){!function(e){"use strict";e.defineMode("nginx",function(e){function t(e){for(var t={},o=e.split(" "),i=0;i<o.length;++i)t[o[i]]=!0;return t}var o,i=t("break return rewrite set accept_mutex accept_mutex_delay access_log add_after_body add_before_body add_header addition_types aio alias allow ancient_browser ancient_browser_value auth_basic auth_basic_user_file auth_http auth_http_header auth_http_timeout autoindex autoindex_exact_size autoindex_localtime charset charset_types client_body_buffer_size client_body_in_file_only client_body_in_single_buffer client_body_temp_path client_body_timeout client_header_buffer_size client_header_timeout client_max_body_size connection_pool_size create_full_put_path daemon dav_access dav_methods debug_connection debug_points default_type degradation degrade deny devpoll_changes devpoll_events directio directio_alignment empty_gif env epoll_events error_log eventport_events expires fastcgi_bind fastcgi_buffer_size fastcgi_buffers fastcgi_busy_buffers_size fastcgi_cache fastcgi_cache_key fastcgi_cache_methods fastcgi_cache_min_uses fastcgi_cache_path fastcgi_cache_use_stale fastcgi_cache_valid fastcgi_catch_stderr fastcgi_connect_timeout fastcgi_hide_header fastcgi_ignore_client_abort fastcgi_ignore_headers fastcgi_index fastcgi_intercept_errors fastcgi_max_temp_file_size fastcgi_next_upstream fastcgi_param fastcgi_pass_header fastcgi_pass_request_body fastcgi_pass_request_headers fastcgi_read_timeout fastcgi_send_lowat fastcgi_send_timeout fastcgi_split_path_info fastcgi_store fastcgi_store_access fastcgi_temp_file_write_size fastcgi_temp_path fastcgi_upstream_fail_timeout fastcgi_upstream_max_fails flv geoip_city geoip_country google_perftools_profiles gzip gzip_buffers gzip_comp_level gzip_disable gzip_hash gzip_http_version gzip_min_length gzip_no_buffer gzip_proxied gzip_static gzip_types gzip_vary gzip_window if_modified_since ignore_invalid_headers image_filter image_filter_buffer image_filter_jpeg_quality image_filter_transparency imap_auth imap_capabilities imap_client_buffer index ip_hash keepalive_requests keepalive_timeout kqueue_changes kqueue_events large_client_header_buffers limit_conn limit_conn_log_level limit_rate limit_rate_after limit_req limit_req_log_level limit_req_zone limit_zone lingering_time lingering_timeout lock_file log_format log_not_found log_subrequest map_hash_bucket_size map_hash_max_size master_process memcached_bind memcached_buffer_size memcached_connect_timeout memcached_next_upstream memcached_read_timeout memcached_send_timeout memcached_upstream_fail_timeout memcached_upstream_max_fails merge_slashes min_delete_depth modern_browser modern_browser_value msie_padding msie_refresh multi_accept open_file_cache open_file_cache_errors open_file_cache_events open_file_cache_min_uses open_file_cache_valid open_log_file_cache output_buffers override_charset perl perl_modules perl_require perl_set pid pop3_auth pop3_capabilities port_in_redirect postpone_gzipping postpone_output protocol proxy proxy_bind proxy_buffer proxy_buffer_size proxy_buffering proxy_buffers proxy_busy_buffers_size proxy_cache proxy_cache_key proxy_cache_methods proxy_cache_min_uses proxy_cache_path proxy_cache_use_stale proxy_cache_valid proxy_connect_timeout proxy_headers_hash_bucket_size proxy_headers_hash_max_size proxy_hide_header proxy_ignore_client_abort proxy_ignore_headers proxy_intercept_errors proxy_max_temp_file_size proxy_method proxy_next_upstream proxy_pass_error_message proxy_pass_header proxy_pass_request_body proxy_pass_request_headers proxy_read_timeout proxy_redirect proxy_send_lowat proxy_send_timeout proxy_set_body proxy_set_header proxy_ssl_session_reuse proxy_store proxy_store_access proxy_temp_file_write_size proxy_temp_path proxy_timeout proxy_upstream_fail_timeout proxy_upstream_max_fails random_index read_ahead real_ip_header recursive_error_pages request_pool_size reset_timedout_connection resolver resolver_timeout rewrite_log rtsig_overflow_events rtsig_overflow_test rtsig_overflow_threshold rtsig_signo satisfy secure_link_secret send_lowat send_timeout sendfile sendfile_max_chunk server_name_in_redirect server_names_hash_bucket_size server_names_hash_max_size server_tokens set_real_ip_from smtp_auth smtp_capabilities smtp_client_buffer smtp_greeting_delay so_keepalive source_charset ssi ssi_ignore_recycled_buffers ssi_min_file_chunk ssi_silent_errors ssi_types ssi_value_length ssl ssl_certificate ssl_certificate_key ssl_ciphers ssl_client_certificate ssl_crl ssl_dhparam ssl_engine ssl_prefer_server_ciphers ssl_protocols ssl_session_cache ssl_session_timeout ssl_verify_client ssl_verify_depth starttls stub_status sub_filter sub_filter_once sub_filter_types tcp_nodelay tcp_nopush thread_stack_size timeout timer_resolution types_hash_bucket_size types_hash_max_size underscores_in_headers uninitialized_variable_warn use user userid userid_domain userid_expires userid_mark userid_name userid_p3p userid_path userid_service valid_referers variables_hash_bucket_size variables_hash_max_size worker_connections worker_cpu_affinity worker_priority worker_processes worker_rlimit_core worker_rlimit_nofile worker_rlimit_sigpending worker_threads working_directory xclient xml_entities xslt_stylesheet xslt_typesdrew@li229-23"),r=t("http mail events server types location upstream charset_map limit_except if geo map"),s=t("include root server server_name listen internal proxy_pass memcached_pass fastcgi_pass try_files"),l=e.indentUnit;function a(e,t){return o=t,e}function n(e,t){e.eatWhile(/[\w\$_]/);var o=e.current();if(i.propertyIsEnumerable(o))return"keyword";if(r.propertyIsEnumerable(o))return"variable-2";if(s.propertyIsEnumerable(o))return"string-2";var l=e.next();return"@"==l?(e.eatWhile(/[\w\\\-]/),a("meta",e.current())):"/"==l&&e.eat("*")?(t.tokenize=u,u(e,t)):"<"==l&&e.eat("!")?(t.tokenize=c,c(e,t)):"="!=l?"~"!=l&&"|"!=l||!e.eat("=")?'"'==l||"'"==l?(t.tokenize=function(e){return function(t,o){for(var i,r=!1;null!=(i=t.next())&&(i!=e||r);)r=!r&&"\\"==i;return r||(o.tokenize=n),a("string","string")}}(l),t.tokenize(e,t)):"#"==l?(e.skipToEnd(),a("comment","comment")):"!"==l?(e.match(/^\s*\w*/),a("keyword","important")):/\d/.test(l)?(e.eatWhile(/[\w.%]/),a("number","unit")):/[,.+>*\/]/.test(l)?a(null,"select-op"):/[;{}:\[\]]/.test(l)?a(null,l):(e.eatWhile(/[\w\\\-]/),a("variable","variable")):a(null,"compare"):void a(null,"compare")}function u(e,t){for(var o,i=!1;null!=(o=e.next());){if(i&&"/"==o){t.tokenize=n;break}i="*"==o}return a("comment","comment")}function c(e,t){for(var o,i=0;null!=(o=e.next());){if(i>=2&&">"==o){t.tokenize=n;break}i="-"==o?i+1:0}return a("comment","comment")}return{startState:function(e){return{tokenize:n,baseIndent:e||0,stack:[]}},token:function(e,t){if(e.eatSpace())return null;o=null;var i=t.tokenize(e,t),r=t.stack[t.stack.length-1];return"hash"==o&&"rule"==r?i="atom":"variable"==i&&("rule"==r?i="number":r&&"@media{"!=r||(i="tag")),"rule"==r&&/^[\{\};]$/.test(o)&&t.stack.pop(),"{"==o?"@media"==r?t.stack[t.stack.length-1]="@media{":t.stack.push("{"):"}"==o?t.stack.pop():"@media"==o?t.stack.push("@media"):"{"==r&&"comment"!=o&&t.stack.push("rule"),i},indent:function(e,t){var o=e.stack.length;return/^\}/.test(t)&&(o-="rule"==e.stack[e.stack.length-1]?2:1),e.baseIndent+o*l},electricChars:"}"}}),e.defineMIME("text/x-nginx-conf","nginx")}(o("VrN/"))}}]);